#cloud-config
autoinstall:
  version: 1
  locale: en_US.UTF-8
  keyboard:
    layout: us

  identity:
    hostname: homelab
    username: ansible
    # /opt/homebrew/opt/openssl/bin/openssl passwd -6 "unused"
    password: "$6$rounds=4096$6$g8T4GsqAal/yQ6ti$vl9mobPIzfyCOIf242Fasab039z4CFStTXTI9afBGbyWkBjdPrAwdSWyAwYRpDjav8r6YQ6IYqk4LY8vqpkH81"

  ssh:
    install-server: true
    allow-pw: false
    authorized-keys:
      # MBP 16 M4
      - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIM7Q2kGNSK3dETkqaGjPmSu/gwDrIHPv9MWXfI0Oc5xt iam@damir.space"
      # Thinkpad T14S Gen4
      - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKb/UdPCQ+bdFcNMvf0oysoh1aDICEOePVfSe9/Hp1h3 iam@damir.space"

  storage:
    layout:
      name: direct

  packages:
    - python3
    - python3-apt
    - ca-certificates
    - curl
    - openssh-server

  updates: security

  late-commands:
    - curtin in-target -- systemctl enable --now ssh
    - curtin in-target -- usermod -L ansible

